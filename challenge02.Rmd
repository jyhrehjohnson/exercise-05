---
title: "challenge02"
author: "Jyhreh Johnson"
date: "2/24/2022"
output: html_document
---
Challenge 2

1. Using the {tidyverse} read_csv() function, load the “zombies.csv” dataset from this URL as a “tibble” named z.
```{r}
library(tidyverse)
f1 <- "https://raw.githubusercontent.com/difiore/ada-2022-datasets/main/zombies.csv"
z <- read_csv(f1, col_names = TRUE)
head(z)
```

2. Calculate the population mean and standard deviation for each quantitative random variable in the dataset (height, weight, age, number of zombies killed, and years of education).
```{r}
library(radiant)
p_means <- dplyr::summarize(z, mean(height), mean(weight),  
                            mean(age), mean(zombies_killed),
                            mean(years_of_education)) 

p_sd <- dplyr::summarize(z, sdpop(height), sdpop(weight),  
                            sdpop(age), sdpop(zombies_killed),
                            sdpop(years_of_education))
```

3. Use {ggplot} and make boxplots of each of these variables by gender.
```{r}
library(cowplot)
#gender x height
zb1 <- ggplot(data = z, aes(x = gender, y = height))
zb1 <- zb1 + geom_boxplot(na.rm = TRUE)
zb1 <- zb1 + theme(axis.text.x=element_text(angle = 90))
zb1 <- zb1 + xlab("gender") + ylab("height")

#gender x weight
zb2 <- ggplot(data = z, aes(x = gender, y = weight))
zb2 <- zb2 + geom_boxplot(na.rm = TRUE)
zb2 <- zb2 + theme(axis.text.x=element_text(angle = 90))
zb2 <- zb2 + xlab("gender") + ylab("weight")

#gender x age
zb3 <- ggplot(data = z, aes(x = gender, y = age))
zb3 <- zb3 + geom_boxplot(na.rm = TRUE)
zb3 <- zb3 + theme(axis.text.x=element_text(angle= 90))
zb3 <- zb3 + xlab("gender") + ylab("age")

#gender x zombies_killed
zb4 <- ggplot(data = z, aes(x = gender, y = zombies_killed))
zb4 <- zb4 + geom_boxplot(na.rm = TRUE)
zb4 <- zb4 + theme(axis.text.x=element_text(angle = 90))
zb4 <- zb4 + xlab("gender") + ylab("zombies_killed")

#gender x years_of_education
zb5 <- ggplot(data = z, aes(x = gender, y = years_of_education))
zb5 <- zb5 + geom_boxplot(na.rm = TRUE)
zb5 <- zb5 + theme(axis.text.x=element_text(angle = 90))
zb5 <- zb5 + xlab("gender") + ylab("years_of_education")

plot_grid(zb1, zb2, zb3, zb4, zb5, label_size = 12, nrow =2)
```

4. Use {ggplot} and make scatterplots of height and weight in relation to age (i.e., use age as the x variable), using different colored points for males versus females.
```{r}
#age x height
z_scat1 <- ggplot(data = z, aes(x = age, y = height, color = factor(gender)))
z_scat1 <- z_scat1 + xlab("age") + ylab("height")
z_scat1 <- z_scat1 + geom_point(na.rm = TRUE)
z_scat1 <- z_scat1 + theme(legend.position = "bottom", legend.title = element_blank())

#age x weight
z_scat2 <- ggplot(data = z, aes(x = age, y = weight, color = factor(gender)))
z_scat2 <- z_scat2 + xlab("age") + ylab("weight")
z_scat2 <- z_scat2 + geom_point(na.rm = TRUE)
z_scat2 <- z_scat2 + theme(legend.position = "bottom", legend.title = element_blank())

plot_grid(z_scat1, z_scat2,label_size = 12, nrow = 2)
```
Do these variables seem to be related? In what way?
-Yes, height & age and weight & age appear to have linear relationships.

5. Using histograms and Q-Q plots, check whether each of the quantitative variables seem to be drawn from a normal distribution. Which seem to be and which do not?
-Histograms
```{r}
zq1 <- ggplot(data = z, aes(x  = height)) + geom_histogram(bins = 30) + ggtitle("Height")

zq2 <- ggplot(data = z, aes(x  = weight)) + geom_histogram(bins = 30) + ggtitle("Weight")

zq3 <- ggplot(data = z, aes(x  = age)) + geom_histogram(bins = 30) + ggtitle("Age")

zq4 <- ggplot(data = z, aes(x  = zombies_killed)) + geom_histogram(bins = 30) + ggtitle("Zombies_Killed")

zq5 <- ggplot(data = z, aes(x  = years_of_education)) + geom_histogram(bins = 30) + ggtitle("Years_of_Education")
```
**Note**:I couldn't figure out how to work qqnorm & qqline so i decided to use ggpubr. Is it possible to use library(car) here? When I did the graph loaded with a blue overlay on the data. 

Q-Q Plots
```{r}
library(ggpubr)
zq6 <- ggqqplot(z$height, title = "Height")
zq7 <- ggqqplot(z$weight, title = "Weight")
zq8 <- ggqqplot(z$age, title = "Age")
zq9 <- ggqqplot(z$zombies_killed, title = "Zombies_killed")
zq10 <- ggqqplot(z$years_of_education, title = "Years_of_Education")

plot_grid(zq1, zq2, zq3, zq6, zq7, zq8, label_size = 12, nrow = 2)
plot_grid(zq4, zq5, zq9, zq10, label_size = 12, nrow = 2 )
```
Which seem to be and which do not?
-Height, Weight, and Age all appear to be evenly distributed, but Zombies_Killed and Years_of_education are not normally distributed. ZK and YOE may be plotted with a different distribution???

6. Now use the sample_n() function from {dplyr} to sample ONE subset of 50 zombie apocalypse survivors (without replacement) from this population and calculate the mean and sample standard deviation for each variable. Also estimate the standard error for each variable based on this one sample and use that to construct the theoretical 95% confidence interval for each mean. You can use either the standard normal or a Student’s t distribution to derive the critical values needed to calculate the lower and upper limits of the CI.
```{r}
#should we make functions like in Module 14??
set.seed(1) #set the seed to randomly draw sample
n1 <- 50 
s1 <- sample_n(z, size = n1, replace = FALSE)

y <- select(s1, height, weight, age, zombies_killed, years_of_education) #select these columns from data frame to create new tibble with information

survivors50 <- tibble(variable = character(), s_mean = numeric(), s_sd = numeric(), s_se = numeric(), lower_ci = numeric(), upper_ci = numeric()) #create new tibble to store data

#create a for loop to loop through each variable selected for in y and calculate the mean, sd, and se [like Module13]
for (i in seq_along(y)) {
  s_mean <- mean(y[[i]])
  s_sd <- sd(y[[i]])
  s_se <- sd / sqrt(50) #this throws off knitting
  lower_ci <- s_mean + qnorm(0.05 / 2) * s_se #calculate lower limit
  upper_ci <- s_mean - qnorm(0.05 / 2) * s_se #calculate upper limit
  survivors50 <- add_row(survivors50, variable = (colnames(y)[i]), s_mean = s_mean, s_sd = s_sd, s_se = s_se, lower_ci = lower_ci, upper_ci = upper_ci) #fill in tibble
}

survivors50
```

7. Then draw another 199 random samples of 50 zombie apocalypse survivors out and calculate the mean for each of the these samples. Together with the first sample you drew out, you now have a set of 100 means for each variable (each based on 50 observations), which constitutes a sampling distribution for each variable. [is 199 a typo?]
```{r}
set.seed(1) #set to randomly pull sample
a <- 199
#create a new tibble
survivors199 <- tibble(
  z_seq = c(1:199),#vector of 1-199
  height_mean = do(a) * mean(~height, data = sample_n(z, size = n1, replace = FALSE)),
  
  weight_mean = do(a) * mean(~weight, data = sample_n(z, size = n1, replace = FALSE)),
  
  age_mean = do(a) * mean(~age, data = sample_n(z, size = n1, replace = FALSE)),
  
  zk_mean = do(a) * mean(~zombies_killed, data = sample_n(z, size = n1, replace = FALSE)),
  
  ed_mean = do(a) * mean(~years_of_education, data = sample_n(z, size = n1, replace = FALSE)),
)

survivors199

#{originally tried to execute the code below}
#set.seed(1)

#survivors99 <- tibble(
  #z_seq = c(1:99),
  #height_mean = do(99) * mean(z$height, na.rm = TRUE),
  #weight_mean = do(99) * mean(z$weight, na.rm = TRUE),
  #age_mean = do(99) * mean(z$age, na.rm = TRUE),
  #zombieK_mean = do(99) * mean(z$zombies_killed, na.rm = TRUE),
  #ed_mean = do(99) * mean(z$years_of_education, na.rm = TRUE)
#)

#survivors99
```

What are the means and standard deviations of the sampling distribution for each variable?
-Means
```{r} 
#Find the means from the survivors50 tibble, need to index where data is pulled from. Use code to tell each row and column[[x,y]]
h_meanDist <- (mean(~mean, data = survivors199$height_mean) + survivors50[[1,2]]) #do we need to /2?
h_meanDist

w_meanDist <- (mean(~mean, data = survivors199$weight_mean) + survivors50[[2,2]])#/2?
w_meanDist

a_meanDist <- (mean(~mean, data = survivors199$age_mean) + survivors50[[3,2]])#/2?
a_meanDist

zk_meanDist<- (mean(~mean, data = survivors199$zk_mean) + survivors50[[4,2]])#/2?
zk_meanDist

ed_meanDist <- (mean(~mean, data = survivors199$ed_mean) + survivors50[[5,2]])#/2?
ed_meanDist
```
-Standard Deviations
```{r}
h_meanSD <- sd(~mean, data = survivors199$height_mean)
w_meanSD <- sd(~mean, data = survivors199$weight_mean)
a_meanSD <- sd(~mean, data = survivors199$age_mean)
zk_meanSD <- sd(~mean, data = survivors199$zk_mean)
ed_meanSD <- sd(~mean, data = survivors199$ed_mean)

s_distSD <- c(h_meanSD,  w_meanSD, a_meanSD, zk_meanSD,ed_meanSD)
```

8. Finally, construct a 95% confidence interval for each mean directly from the sampling distribution of sample means using the central 95% that distribution (i.e., by setting the lower and upper CI bounds to 2.5% and 97.5% of the way through that distribution).
```{r}
percent_ci <- 95
alpha <- 1 - percent_ci/100

h_lowerCI <- h_meanDist + qnorm(alpha/2) * h_meanSD
h_upperCI <- h_meanDist + qnorm(1-alpha/2) * h_meanSD
height_CI <- c(h_lowerCI, h_upperCI)

w_lowerCI <- w_meanDist + qnorm(alpha/2) * w_meanSD
w_upperCI <- w_meanDist + qnorm(1-alpha/2) * w_meanSD
weight_CI <- c(w_lowerCI, w_upperCI)

a_lowerCI <- a_meanDist + qnorm(alpha/2) * a_meanSD
a_upperCI <- a_meanDist + qnorm(1-alpha/2) * a_meanSD
age_CI <- c(a_lowerCI, a_upperCI)

zk_lowerCI <- zk_meanDist + qnorm(alpha/2) * zk_meanSD
zk_upperCI <- zk_meanDist + qnorm(1-alpha/2) * zk_meanSD
zombies_killed_CI <- c(zk_lowerCI, zk_upperCI)

ed_lowerCI <- ed_meanDist + qnorm(alpha/2) * ed_meanSD
ed_upperCI <- ed_meanDist + qnorm(1-alpha/2) * ed_meanSD
education_CI <- c(ed_lowerCI, ed_upperCI)
```
```{r}
CIs <- tibble(
  "Variable" = c("Height", "Weight", "Age", "Zombies_Killed", "Years of Education"),
  "Lower" = c(h_lowerCI, w_lowerCI,a_lowerCI, zk_lowerCI, ed_lowerCI), 
  "Upper" =  c(h_upperCI, w_upperCI,a_upperCI, zk_upperCI, ed_upperCI)
)

CIs
  #The code below also worked with tibble, but did not work when it came time to compare CIs in the last question. So I adjusted to the code above to be able to make comparison4. 

  #"Confidence Interval" = c("Lower", "Upper"),
  #height_CI,
  #weight_CI,
  #age_CI,
  #zombies_killed_CI,
  #education_CI)
```

9. How do the standard deviations of the sampling distribution for each variable compare to the standard errors estimated from your first sample of size 50? 
-The Standard dev. of the sampling distribution of each variable and standard error estimates are about the same.
```{r}
survivors50SEs <- survivors50[ , c(1,4)]
comparison3 <- add_column(survivors50SEs, s_distSD)

comparison3
```

What do sampling distributions for each variable mean look like? Are they normally distributed? 
-All of them look normal
```{r}
histogram(~mean, data = survivors199$height_mean, main = "Sampling Distribution (Height Means)")

histogram(~mean, data = survivors199$weight_mean, main = "Sampling Distribution (Weight Means)")

histogram(~mean, data = survivors199$age_mean, main = "Sampling Distribution (Age Means)")

histogram(~mean, data = survivors199$zk_mean, main = "Sampling Distribution (Means of Zombies Killed)")

histogram(~mean, data = survivors199$ed_mean, main = "Sampling Distribution (Means of Years of Education)")
```

What about for those variables that you concluded were not originally drawn from a normal distribution? 
-Originally, I thought that height,weight, and age were normally distributed and zombies killed/years of education were of a different distribution but now they appear to all be similar.

How do the two 95% CIs you estimated compare to one another (i.e., the CI based on one sample and the corresponding sample standard deviation versus the CI based on simulation where you created a sampling distribution across 200 samples)?
```{r}
survivors50CIs <- survivors50[ , c(5,6)]
comparison4 <- add_column(CIs, survivors50CIs)

comparison4
```